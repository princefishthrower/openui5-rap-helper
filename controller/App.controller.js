sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/Dialog"],function(e,t,n,o){"use strict";return e.extend("sap.ui.demo.todo.controller.App",{onInit:function(){var e={title:"",textContent:"",textLength:0,editContent:"",editLength:0};var n=new t(e);sap.ui.getCore().setModel(n,"enteredText");var o=new t({rhymeList:[],lastRhyme:"incognito",userSyllable:null});sap.ui.getCore().setModel(o,"rhymes");var s=this;this.getView().byId("titleInput").onsapenter=function(e){s.setTitle()};this.getView().byId("textMultiInput").onsapenter=function(e){s.addLine()};this.getView().byId("rhymesComboBox").onsapenter=function(e){s.userRhyme()};this.getView().byId("userSyllable").onsapenter=function(e){s.userSyllable()}},onAfterRendering:function(){var e=this.getView();var t=sap.ui.getCore().getModel("enteredText");e.setModel(t);var n=e.byId("rhymesComboBox");var o=sap.ui.getCore().getModel("rhymes");n.setModel(o);var s=e.byId("userSyllable");s.setModel(o);var a=this;this.getView().byId("textMultiInput").addValidator(function(e){console.log(e);a.addLineFromValidator(e.text)});var r=e.byId("lyricsContainer");var i=new sap.m.List("enteredLines",{mode:"Delete",noDataText:"Fresh lines you write will appear here..."});i.attachDelete(this.deleteLine,this);r.addContent(i);this.getRhymes("incognito");this.getView().byId("rhymesComboBox").setValue("incognito")},setLastRhyme:function(e){var t=e.split(" ").splice(-1);this.getView().byId("rhymesComboBox").setValue(t);this.getRhymes(t)},liveInputChange:function(){console.log("in here!");var e=sap.ui.getCore().getModel("enteredText").getProperty("/textContent");var t=this.syllableCount(e);sap.ui.getCore().getModel("enteredText").setProperty("/textLength",t);var n=sap.ui.getCore().byId("enteredLines").getItems();if(n.length===0){return}var o=n[n.length-1].getInfo();console.log(o);var s=parseInt(o.substring(12).replace(")",""),0);var a=this.getView().byId("syllableText");if(t===s){if(a.hasStyleClass("red")){a.removeStyleClass("red");a.addStyleClass("green")}}else{if(a.hasStyleClass("green")){a.removeStyleClass("green");a.addStyleClass("red")}}},liveInputEditChange:function(){var e=this.syllableCount(sap.ui.getCore().getModel("enteredText").getProperty("/editContent"));sap.ui.getCore().getModel("enteredText").setProperty("/editLength",e)},syllableCount:function(e){e=e.toLowerCase();if(e.length===0){return 0}var t=e.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/,"").replace(/^y/,"").match(/[aeiouy]{1,2}/g);if(t){t=t.length}else{t=0}return t},addLine:function(){var e=sap.ui.getCore().getModel("enteredText").getProperty("/textContent");var t=sap.ui.getCore().getModel("enteredText").getProperty("/textLength").toString();this.setLastRhyme(e);sap.ui.getCore().getModel("enteredText").setProperty("/textContent","");sap.ui.getCore().getModel("enteredText").setProperty("/textLength",0);var n=this.getView().byId("syllableText");if(n.hasStyleClass("green")){n.removeStyleClass("green");n.addStyleClass("red")}var o=this;var s=new sap.m.StandardListItem({type:"Active",press:function(e){o.editLine(e,o)},title:e,info:"(Syllables: "+t+")"});var a=sap.ui.getCore().byId("enteredLines");a.addItem(s);this.addDragAndDrop(a)},addLineFromValidator:function(e){var t=this.syllableCount(e);var n=new sap.m.StandardListItem({title:e,info:"(Syllables: "+t+")"});n.setType("Active");var o=sap.ui.getCore().byId("enteredLines");o.addItem(n);this.getView().byId("textMultiInput").setValue("")},editLine:function(e,t){var s=e.getSource();var a=sap.ui.getCore().getModel("enteredText");var r=s.getTitle();a.setProperty("/editContent",r);var i=new sap.m.Input("modalInput",{value:"{/editContent}",valueLiveUpdate:true,liveChange:function(){t.liveInputEditChange()}});i.setLayoutData(new sap.ui.layout.GridData({span:"L8 M8 S8"}));i.setModel(a);var l=new sap.m.Text("editSyllables",{text:"(Syllables: {/editLength})"});l.addStyleClass("sapUiSmallMargin");l.setLayoutData(new sap.ui.layout.GridData({span:"L2 M2 S2"}));l.setModel(a);var d=new o({title:"Edit your fresh line!",type:"Message",content:[i,l],beginButton:new n({icon:"sap-icon://accept",text:"OK",press:function(){var e=sap.ui.getCore().getModel("enteredText").getProperty("/editContent");s.setTitle(e);d.close()}}),endButton:new n({icon:"sap-icon://sys-cancel",text:"Cancel",press:function(){d.close()}}),afterClose:function(){d.destroy()}});sap.ui.getCore().byId("modalInput").onsapenter=function(e){var t=sap.ui.getCore().getModel("enteredText").getProperty("/editContent");s.setTitle(t);d.close()};t.liveInputEditChange();d.open();i.focus();var u=i.getValue();i.setValue("");i.setValue(u)},addDragAndDrop:function(e){var t=e.getId();var n="#"+t+"-listUl";$(document).ready(function(){$(n).addClass("ui-sortable");$(n).sortable({connectWith:".ui-sortable"}).disableSelection()})},deleteLine:function(e){var t=e.getSource();var n=e.getParameter("listItem");n.destroy();var o=sap.ui.getCore().byId("enteredLines").getItems();if(o.length>0){this.setLastRhyme(o[o.length-1].getTitle())}this.addDragAndDrop(t)},getRhymes:function(e,t){var n="https://rhymebrain.com/talk?function=getRhymes&word=";sap.ui.getCore().getModel("rhymes").setProperty("/lastRhyme",e);$.ajax({url:n+e,type:"GET",success:function(e){sap.ui.getCore().getModel("rhymes").setProperty("/rhymeList",e);if(t){t.setOpen(true)}}})},userRhyme:function(){var e=this.getView();var t=e.byId("rhymesComboBox");var n=t.getValue();this.getRhymes(n,t)},userSyllable:function(){var e=sap.ui.getCore().getModel("rhymes").getProperty("/userSyllable");var t=e.toString();console.log(this.getView().byId("rhymesComboBox"));var n=this.getView().byId("rhymesComboBox").getBinding("items");console.log(t);var o=new sap.ui.model.Filter("syllables",sap.ui.model.FilterOperator.EQ,t);n.filter([o])},save:function(){var e=sap.ui.getCore().byId("enteredLines").getItems();var t="";for(var n=0;n<e.length;n++){t=t+e[n].getTitle();t=t+"\t\t\t\t"+e[n].getInfo();t=t+"\n"}console.log(t);if(t!==""){var o=document.createElement("a");o.setAttribute("download","rap_annotations.txt");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t));o.click()}},saveNoAnno:function(){var e=sap.ui.getCore().byId("enteredLines").getItems();var t="";for(var n=0;n<e.length;n++){t=t+e[n].getTitle();t=t+"\n"}console.log(t);if(t!==""){var o=document.createElement("a");o.setAttribute("download","rap_no_annotations.txt");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t));o.click()}},autoScroll:function(){var e=sap.ui.getCore().byId("enteredLines").getItems();var t=e.length*36;var n=e.length*2500;console.log(t);console.log(n);this.getView().byId("lyricsContainer").scrollTo(0,t,n)},onDeleteAll:function(){var e=new sap.m.Text("deleteAllEnsureText",{text:"Are you sure you want to delete ALL the lines of your fresh rap?"});var t=this;var s=new o({title:"Really delete all?",type:"Message",content:[e],beginButton:new n({icon:"sap-icon://accept",text:"Yes",press:function(){t.deleteAll();s.close()}}),endButton:new n({icon:"sap-icon://sys-cancel",text:"Cancel",press:function(){s.close()}}),afterClose:function(){s.destroy()}});s.open()},deleteAll:function(){sap.ui.getCore().byId("enteredLines").destroyItems();var e=this.getView().byId("syllableText");if(e.hasStyleClass("red")){e.removeStyleClass("red");e.addStyleClass("green")}}})});